!function(a){"function"==typeof define&&define.amd?define(["jquery"],a):"object"==typeof module&&module.exports?module.exports=a(require("jquery")):a(jQuery)}(function(a){function b(d,e){b.counter=b.counter||0;var f="whenInViewport"+ ++b.counter;return i[f]=a.extend({},a.whenInViewport.defaults,e,{$el:d,topOffset:d.offset().top}),g||(g=k(c,0)),g(),f}function c(){var a=h.scrollTop();for(var b in i){var c=i[b];a+f>c.topOffset-c.threshold&&(delete i[b],c.callback.call(c.context||window,c.$el),l.checkRegistry())}}function d(){f=h.height();for(var a in i)i[a].topOffset=i[a].$el.offset().top}function e(c,d){"undefined"==typeof f&&(f=h.height()),this.key=b(a(c),d),l.checkRegistry()}var f,g,h=a(window),i={},j=100,k=function(a,b){return a},l={setuped:!1,setup:function(){this.setuped||(this.scrollHandler=this.scrollHandler||k(c,j),this.resizeHandler=this.resizeHandler||k(d,j),h.on("scroll",this.scrollHandler).on("resize",this.resizeHandler),this.setuped=!0,f=h.height())},destroy:function(){this.setuped&&h.off("scroll",this.scrollHandler).off("resize",this.resizeHandler),this.setuped=!1},checkRegistry:function(){a.isEmptyObject(i)?this.destroy():this.setup()}};return e.prototype.stopListening=function(){delete i[this.key],l.checkRegistry()},a.extend(e,{setDelayEngine:function(a){return k=a,this},setDelayTimeout:function(a){return j=a,this},destroy:function(){i={},l.destroy()}}),e.defaults={callback:function(){},threshold:0,context:null,setupOnce:!1},a.WhenInViewport=a.whenInViewport=e,a.fn.whenInViewport=function(b,c){return"function"==typeof b&&(b=a.extend({},c,{callback:b})),this.each(function(){b.setupOnce?!a.data(this,"whenInViewport")&&a.data(this,"whenInViewport",new e(this,b)):a.data(this,"whenInViewport",new e(this,b))})},a});